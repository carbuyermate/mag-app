# Mobilny Asystent Geodezyjny (MAG) - Dokumentacja i Specyfikacja Projektu

## 1. O aplikacji (Czym jest MAG?)
Mobilny Asystent Geodezyjny to ultralekka, bezpieczna, jednoplikowa aplikacja internetowa (Single-Page Application w architekturze HTML/CSS/JS), pełniąca funkcję podręcznego systemu informacji przestrzennej (GIS). Służy do błyskawicznej weryfikacji danych geodezyjnych, administracyjnych, infrastrukturalnych i ekologicznych na ekranie telefonu lub komputera, bez konieczności instalowania oprogramowania czy zakładania kont.

## 2. Dla kogo jest ta aplikacja? (Grupa Docelowa)
Narzędzie zostało stworzone z myślą o profesjonalistach pracujących "w terenie" oraz osobach potrzebujących natychmiastowego dostępu do danych katastralnych:
- Geodeci (rozpoznanie terenu, lokalizacja punktów startowych, weryfikacja uzbrojenia)
- Architekci i projektanci (szybka ocena chłonności działki, kolizji z sieciami, stref p.poż/ochronnych)
- Urzędnicy i inspektorzy nadzoru budowlanego (kontrola w terenie)
- Rzeczoznawcy majątkowi i pośrednicy nieruchomości (sprawdzanie ksiąg wieczystych i danych z EGiB)
- Inwestorzy prywatni kupujący działki lub planujący budowę (szybki kontakt do urzędów)

## 3. Jaki rozwiązuje problem? (Wartość dla Użytkownika)
Praca z oficjalnymi portalem Geoportal.gov.pl na urządzeniach mobilnych jest wysoce niepraktyczna (skomplikowany interfejs, ogromne obciążenie pamięci telefonu, uciążliwa nawigacja). Mobilny Asystent Geodezyjny rozwiązuje ten problem, oferując:
- **Błyskawiczny czas ładowania:** Aplikacja waży kilkadziesiąt kilobajtów i ładuje mapę natychmiast.
- **Interfejs "Mobile-First":** Duże przyciski, intuicyjne przełączniki (toggles), wysuwane panele kaskadowe optymalizowane pod dotyk i obsługę jedną ręką (np. w słońcu, na budowie).
- **Zasada "Jeden plik = jedno narzędzie":** Aplikację można pobrać na dysk/telefon, wysłać mailem i uruchomić offline (logika i interfejs; mapy ładują się z sieci).
- **Agregacja rozproszonych danych w jednym miejscu:** Użytkownik nie musi przełączać się między wieloma geoportalami (branżowymi, GDOŚ, GUGiK) - MAG nakłada je wszystkie na jedną ośrodek mapowy.
- **Odciąża z biurokracji:** Automatyczne generowanie kodu wydziału Sądu Wieczystoksięgowego i inteligentne linki "Smart Links" kierujące od razu do właściwego Starostwa w Google Maps bez potrzeby żmudnego "guglowania".

## 4. Czym różni się od rządowych i komercyjnych portali rynkowych?
- **Brak przeładowania funkcjami (Over-engineering):** Zamiast tysięcy opcji analitycznych, narzędzi pomiarowych i warstw historycznych (jak w QGIS czy pełnym Geoportalu), MAG stawia na ascetyczne minimum: "Pokaż mi, gdzie jestem (GPS), daj mi adres, nałóż działki, uzbrojenie, strefy ekologiczne i podaj telefon do urzędu".
- **Bezpieczeństwo i prywatność:** Aplikacja działa głównie w przeglądarce klienta (Client-Side). Nie śledzi ruchów użytkownika ani nie loguje zapytań na prywatnych serwerach. Komunikuje się bezpośrednio (P2P) z serwerami polskiego rządu wszędzie tam, gdzie urzędy udostępniają otwarty nagłówek CORS (GDOŚ, GUGiK).
- **Hybrydowy Backend Proxy dla GUNB:** Ponieważ system RWDZ (GUNB) nie wspiera bezpośrednich zapytań z przeglądarki, aplikacja korzysta z Twojego własnego, bezpiecznego serwera Node.js (Render), który pośredniczy tylko w tym jednym zapytaniu. Gwarantuje to 100% dostarczalności danych o pozwoleniach na budowę bez polegania na zewnętrznych, płatnych usługach proxy.

## 5. Kluczowe Funkcje Aplikacji
- ** Geolokalizacja GPS na żywo:** Przycisk centrowania kamery mapy bezpośrednio na fizycznej lokalizacji użytkownika stojącego w szczerym polu.
- ** Inteligentna Wyszukiwarka Adresów:** System autouzupełniania bazujący w pierwszej kolejności na państwowym API (ULDK GUGiK) operującym na oficjalnym słowniku TERYT, a w przypadku błędu – na światowym silniku Nominatim (OpenStreetMap).
- ** Zaawansowany Panel Informacji o Działce:** Kliknięcie w dowolny punkt mapy wysuwa duży boczny panel ze zorganizowanymi sekcjami:
  - **Lokalizacja administracyjna:** Numer działki, TERYT, Województwo, Powiat, Gmina, Obręb.
  - **Ograniczenia i Środowisko:** (P-to-P) Automatyczna detekcja kolizji klikniętej działki z wielkopowierzchniowymi strefami ochrony przyrody GDOŚ. Wykorzystuje wektorową geometrię WKT pobraną z ULDK na bramce WFS (`CQL_FILTER=INTERSECTS`). Ostrzega to architekta o prawnych ograniczeniach terenu.
  - **Sprawy Urzędowe i Smart Links:** Wskazuje właściwe Starostwo i Sąd Rejonowy (Wydział Ksiąg Wieczystych), automatycznie wyliczając prefix KW na podstawie danych TERYT. Generuje "Smart Links" kierujące bezpośrednio do sprawdzonych wizytówek urzędów w aplikacji Google Maps z danymi kontaktowymi i dojazdem.
  - **Księgi Wieczyste Online:** Integracja edukująca, jak uzyskać pełny numer zablokowanej księgi oraz przekierowania do portali z księgami ministerstwa i prywatnych.
- ** Multi-warstwowy podkład mapowy:** Możliwość swobodnego i płynnego przełączania baz formatki między OpenStreetMap, Google Maps Satelita, Esri World Imagery oraz Państwową Ortofotomapą GUGiK wysokiej rozdzielczości.
- ** Engine Mapowy o głębokim powiększeniu (Deep Zoom):** Zmodyfikowany silnik mapowy Leaflet skalujący kafelki za pomocą "maxNativeZoom" poza standardowe limity (do zoomu 24), co pozwala oglądać sub-metrowe detale infrastruktury podziemnej bez znikania warstw.
- ** Optymalizacja czytelności wektorów (DPI Hack):** Wymuszenie na serwerach rządowych renderingu z High-DPI (150dpi) oraz nad-próbkowanie obrazu kafelków WMS (tileSize: 512, zoomOffset: -1) celem pogrubienia mikroskopijnych, 1-pikselowych linii ewidencyjnych i infrastrukturalnych, poprawiając drastycznie czytelność pod słońcem na ekranie roboczym.

## 6. Architektura i Źródła Danych (API & Bazy)
Aplikacja to hybryda (Node.js/Express + Frontend). Moduł mapowy to otwartoźródłowy **Leaflet.js (v1.9.4)**. Translacja układów współrzędnych realizowana przez bibliotekę matematyczną **Proj4js**. Większość zapytań (ULDK, GDOŚ, NMT) trafia bezpośrednio od klienta do urzędu, natomiast zapytania do GUNB są tunelowane przez nasz własny serwer (`server.js`), aby ominąć restrykcje CORS.

Pobierane zbiory danych poprzez standardy OGC (WMS / REST API):

### A. Główny Urząd Geodezji i Kartografii (GUGiK)
- **Podział Administracyjny i Ewidencja (KIEG - Krajowa Integracja Ewidencji Gruntów):**
  - Granice i numery działek ewidencyjnych
  - Kontury budynków (części nadziemne EGiB)
- **Uzbrojenie Terenu (KIUT - Krajowa Integracja Uzbrojenia Terenu) [Wektorowe dane od Starostw z kolorystyką K-1]:**
  - Przewody Wodociągowe, Kanalizacyjne, Gazowe, Elektroenergetyczne, Ciepłownicze, Telekomunikacyjne, Specjalne
- **Ortofotomapa (WMS HighResolution):** Lotnicze zdjęcia powierzchni kraju
- **Usługa Lokalizacji Działek Katastralnych (ULDK API):** Zwraca obrysy WKT i adresologię po współrzędnych XY oraz obsługuje wyszukiwarkę. Używana lokalnie poprzez konwersję lat/lng z wymuszonym WGS84 na płaski układ PUWG 1992 (EPSG:2180).

### B. Generalna Dyrekcja Ochrony Środowiska (GDOŚ) - Usługi SDI
- **Formy Ochrony Przyrody (WMS / WFS):**
  - **Wizualizacja (WMS):** Kafelkowe serwowanie obrazów do swobodnego przeglądania mapy.
  - **Analityka Przestrzenna (WFS):** Skrypt wykorzystuje Web Feature Service jako silnik zapytań wektorowych. Przekazuje on obrys WKT z ULDK do GDOŚ przez `CQL_FILTER=INTERSECTS(geom, ...)` celem sprawdzenia kolizji.
  - Parki Narodowe i Krajobrazowe
  - Ptasie i Siedliskowe obszary Natura 2000 (OSO/SOO)
  - Rezerwaty Przyrody, Pomniki Przyrody
  - Użytki Ekologiczne i Zespoły Przyrodniczo-Krajobrazowe
  - Obszary Chronionego Krajobrazu
  - Stanowiska Dokumentacyjne

### C. Zewnętrzne Bazy Alternatywne
- **OpenStreetMap:** Poprzez serwery bazowe (Mapnik) oraz silnik geokodujący Nominatim.
- **Google / Esri Server:** Warstwy komercyjne zdjęć satelitarnych wyciągane przez bezpośrednie zapytania do Endpointów serwerów kafelkowych XYZ.

## 7. Ograniczenia i Założenia Systemowe (Disclaimer)
Twórcy oparli funkcję na specyfice polskiego modelu agregacji danych KIEG/KIUT: system centralnego WMS rządu zadaje kaskadowe w locie zapytania do rozsianych serwerów strefowych setek ośrodków szczebla powiatowego (PODGiK).
Oznacza to, że widoczność sieci (lub jej brak) bezpośrednio odzwierciedla elektroniczny, realny stan cyfryzacji bazy w konkretnym starostwie. Brak kreski dla sieci na mapie nie oznacza prawnej lub fizycznej nieobecności infrastruktury pod ziemią, o czym użytkownik jest trwale informowany na dedykowanym panelu UI.

Podobnie w przypadku wyników "Analizy Ograniczeń Środowiskowych" – system raportuje bezpośrednie kolizje z prawnymi, wielkopowierzchniowymi strefami chronionymi wyłącznie z rejestru form ochrony przyrody państwowego GDOŚ. Rozwiązanie to nie zwalnia z weryfikacji Miejscowych Planów Zagospodarowania Przestrzennego (MPZP) ani ewidencji miejskich konserwatorów zabytków. Odpowiedni Disclaimer (zastrzeżenie) jest na stałe dołączony do okna wyników analizy chłonnościowej dla bezpieczeństwa użytkownika.
